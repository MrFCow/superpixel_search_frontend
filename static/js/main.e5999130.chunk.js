(this.webpackJsonpsuperpixel=this.webpackJsonpsuperpixel||[]).push([[0],{365:function(e,t,a){},373:function(e,t){},374:function(e,t){},382:function(e,t){},385:function(e,t){},386:function(e,t){},430:function(e,t,a){"use strict";a.r(t);var n=a(25),c=a(11),r=a.n(c),o=a(55),i=a.n(o),s=(a(365),a(307)),u=a.n(s),l=a(434),d=a(458),b=a(436),f=a(4),j=a.n(f),v=a(12),p=a(5),h=a(110),m=r.a.createContext();function x(){var e=r.a.useContext(m);if(!e)throw new Error("useData must be used within a DataProvider");return e}function g(e){var t=r.a.useState({}),a=Object(p.a)(t,2),c=a[0],o=a[1],i=function(e){o((function(t){return Object(h.a)(Object(h.a)({},t),e)}))},s=r.a.useMemo((function(){return[c,i]}),[c]);return Object(n.jsx)(m.Provider,Object(h.a)({value:s},e))}var O=a(19),w=r.a.createContext();function C(){var e=r.a.useContext(w);if(!e)throw new Error("useDebugMsg must be used within a DebugMsgProvider");return e}function k(e){var t=r.a.useState([]),a=Object(p.a)(t,2),c=a[0],o=a[1],i=function(e){o((function(t){return[].concat(Object(O.a)(t),[e])}))},s=r.a.useMemo((function(){return[c,i]}),[c]);return Object(n.jsx)(w.Provider,Object(h.a)({value:s},e))}function y(e){var t=Object(c.useState)(!1),a=Object(p.a)(t,2),o=a[0],i=a[1],s=x(),u=Object(p.a)(s,2)[1],l=C(),d=Object(p.a)(l,2)[1],b=r.a.createRef(),f=Object(c.useCallback)((function(){var e="[Input Field]",t=b.current.files[0],a=new FileReader;a.onloadstart=Object(v.a)(j.a.mark((function a(){return j.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:i(!0),d("".concat(e," - Start Image Loading: ").concat(t.name));case 2:case"end":return a.stop()}}),a)}))),a.onloadend=Object(v.a)(j.a.mark((function n(){var c,r,o;return j.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=a.result,o=null===(c=r.split(","))||void 0===c?void 0:c[1],u({dataUrl:r,dataUrlStripped:o}),i(!1),d("".concat(e," - Finish Image Loading: ").concat(t.name));case 5:case"end":return n.stop()}}),n)}))),a.onerror=function(a){console.error(a),i(!1),d("(ERR) ".concat(e," - Image Loading: ").concat(t.name))},a.readAsDataURL(t)}),[b]);return Object(n.jsx)("input",{type:"file",id:"image_input",name:"Load File",ref:b,onChange:f,disabled:o})}var I=a(46),R=Object(b.a)({canvasRoot:{height:"auto"}});function D(e){var t=R(),a=r.a.useRef(null),o=C(),i=Object(p.a)(o,2)[1],s=x(),u=Object(p.a)(s,2),l=u[0],d=u[1],b=Object(c.useCallback)((function(){var e="[Canvas Effect 2]";i("".concat(e," - Canvas Changed"));try{var t=I.a.fromPixels(a.current);return i("".concat(e," - Tensor with shape: ").concat(t.shape)),t}catch(n){i("(ERR) ".concat(e," - Canvas Changed")),console.error(n)}})),f=Object(c.useCallback)((function(){var e="[Canvas Effect 1]";i("".concat(e," - Image Data Changed Effect"));try{var t=a.current.getContext("2d"),n=new Image;n.onload=function(){var c;i("".concat(e," - Image onLoad")),t.canvas.width=300,t.canvas.height=300*n.height/n.width,t.drawImage(n,0,0,n.width,n.height,0,0,t.canvas.width,t.canvas.height);var r=b(),o=a.current.getBoundingClientRect(),s=a.current.toDataURL();d({imageTensor:r,canvasW:o.width,canvasH:o.height,canvasX:o.x,canvasY:o.y,canvasDataUrl:s,canvasDataUrlStripped:null===(c=s.split(","))||void 0===c?void 0:c[1]}),i("".concat(e," - Update Data: TF tensor and Canvas size"))},n.src=null===l||void 0===l?void 0:l.dataUrl}catch(c){i("(ERR) ".concat(e," - Image Data Changed")),console.error(c)}}),[null===l||void 0===l?void 0:l.dataUrl]);return Object(c.useEffect)((function(){f()}),[null===l||void 0===l?void 0:l.dataUrl]),Object(n.jsx)(n.Fragment,{children:Object(n.jsx)("div",{className:t.canvasRoot,children:Object(n.jsx)("canvas",{ref:function(e){return a.current=e},id:"".concat(e.id),alt:e.alt})})})}var S=a(184),F=a.n(S),N=a(328),E=a.n(N),T=a(329);E()(F.a,{retries:3});var P=Object(b.a)({canvasRoot:function(e){return{height:"auto",position:"absolute",left:e.left}},canvas:function(e){return{opacity:e.alpha}}});function M(){return(M=Object(v.a)(j.a.mark((function e(t,a,n){var c,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://superpixels.herokuapp.com/process",c={image:t,noSegments:a,sigma:n},e.next=4,F()({method:"post",url:"https://superpixels.herokuapp.com/process",data:c,timeout:1e4});case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){return I.j((function(){var t=e.max(),a=e.min(),n=e.sub(a).div(t.sub(a)).mul(I.f(255)),c=n;c=c.expandDims(2),c=I.k(c,[1,1,3]);var r=I.e(n).mul(I.f(255)).expandDims(2);c=I.b([c,r],2);var o=I.i([[-1,-1,-1],[-1,8,-1],[-1,-1,-1]]).expandDims(2).expandDims(3),i=Object(p.a)(n.shape,2),s=i[0],u=i[1],l=I.g({layers:[I.d.conv2d({kernelSize:3,filters:1,strides:1,useBias:!1,padding:"same",inputShape:[s,u,1],weights:[o]})]}).predict(n.expandDims(2).expandDims(0)),d=I.c(l.toInt(),I.f(0)).mul(I.f(255)).toInt().squeeze(0),b=I.l(n).expandDims(2);return[c,d=I.b([d,b,b,d],2)]}))}function U(e){var t=Object(c.useState)(.3),a=Object(p.a)(t,2),o=a[0],i=a[1],s=Object(c.useRef)(new Set),u=Object(c.useRef)(null),l=Object(c.useRef)(null),d=r.a.useRef(null),b=r.a.useRef(null),f=C(),m=Object(p.a)(f,2)[1],g=x(),O=Object(p.a)(g,2),w=O[0],k=O[1],y=P({alpha:o,left:w.canvasX}),R=Object(c.useCallback)((function(e){var t=Object(p.a)(e,2),a=t[0],n=t[1];return[a-w.canvasX,n-w.canvasY]}),[w.canvasX,w.canvasY]),D=Object(T.a)({onDrag:function(e){var t=e.down,a=e.event,n=Object(p.a)(e.xy,2),c=n[0],r=n[1];a.preventDefault(),t&&console.log("xy: (".concat(c.toFixed(2),", ").concat(r.toFixed(2),")"))},onClick:function(e){var t=R([e.event.clientX,e.event.clientY]),a=Object(p.a)(t,2),n=a[0],c=a[1];console.log("clicked ".concat(n.toFixed(2),", ").concat(c.toFixed(2))),I.h(u.current,[c,n,0],[1,1,1]).data().then((function(e){var t,a,n,c=e[0];l.current=(t=l.current,a=u.current,n=c,I.j((function(){var e=a.equal(I.f(n));return t.logicalXor(e)})));var r=I.h(l.current,[0,0,0],[-1,-1,3]).logicalNot();k({maskTensor:r}),c in s.current?(console.log("Try delete value ".concat(c)),s.current.delete(c)):(console.log("Try add value ".concat(c)),s.current.add(c));var o=l.current.toFloat();I.a.toPixels(o,b.current)}))},onMouseEnter:function(e){i(.8)},onMouseLeave:function(e){i(.3)}},{transform:R}),S=Object(c.useCallback)(function(){var e=Object(v.a)(j.a.mark((function e(t,a){var n,c,r,o,i,s;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=I.i(t),c=_(n),r=Object(p.a)(c,2),o=r[0],i=r[1],u.current=I.h(o,[0,0,0],[-1,-1,1]),l.current=I.e(o).toBool(),o.toInt(),s=i,e.abrupt("return",I.a.toPixels(s,a));case 7:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),[]);Object(c.useCallback)((function(e,t){t.globalAlpha=1,e.map((function(e,a){var n=Object(p.a)(e,2),c=n[0],r=n[1];t.fillStyle="#00ff00",t.font="15px Georgia",t.fillText("".concat(r.toFixed(2),",").concat(c.toFixed(2)),r+10,c+25),t.fillStyle="#ff0000",t.fillRect(r,c,5,5)}))}),[]);return Object(c.useEffect)((function(){if(null===w||void 0===w?void 0:w.canvasDataUrl){var e="[SuperPixel Canvas Effect 1]";try{m("".concat(e," - try call getSuperPixel"));var t=d.current.getContext("2d");t.globalAlpha=1,t.clearRect(0,0,w.canvasW,w.canvasH),function(e,t,a){return M.apply(this,arguments)}(w.canvasDataUrlStripped,100).then((function(t){console.log(t),m("".concat(e," - getSuperPixel call completed"));try{var a,n=null===t||void 0===t||null===(a=t.data)||void 0===a?void 0:a.data,c=(n.centroids,n.segments);S(c,d.current).then((function(){}))}catch(r){m("(ERR) ".concat(e," - Draw fail")),console.error(r)}}))}catch(a){m("(ERR) ".concat(e," - Superpixel")),console.error(a)}}}),[null===w||void 0===w?void 0:w.canvasDataUrl]),Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("div",Object(h.a)(Object(h.a)({className:y.canvasRoot},D()),{},{style:{zIndex:2},children:Object(n.jsx)("canvas",{className:y.canvas,ref:function(e){d.current=e},id:"".concat(e.id),alt:e.alt})})),Object(n.jsx)("div",{className:y.canvasRoot,style:{zIndex:1},children:Object(n.jsx)("canvas",{className:y.canvas,ref:function(e){b.current=e},id:"".concat(e.id,"_mask"),alt:"".concat(e.alt," Mask")})})]})}var L=Object(b.a)({canvasRoot:{height:"auto"}});function z(e){var t=L(),a=r.a.useRef(null),o=C(),i=(Object(p.a)(o,2)[1],x()),s=Object(p.a)(i,2),u=s[0];s[1];return Object(c.useEffect)((function(){if(u.imageTensor&&u.maskTensor){var e=u.imageTensor.mul(u.maskTensor.toInt()).add(u.maskTensor.logicalNot().toInt().mul(I.f(255)));I.a.toPixels(e.toInt(),a.current)}}),[u.maskTensor,u.imageTensor]),Object(n.jsx)("div",{className:t.canvasRoot,children:Object(n.jsx)("canvas",{ref:function(e){a.current=e},id:"".concat(e.id),alt:e.alt})})}var B=a(460),X=a(459),A=function(e){return{authority:"api.pinterest.com","Content-Type":"multipart/form-data; boundary=".concat(e._boundary),accept:"*/*"}},W="https://cors-anywhere.herokuapp.com/";function Y(){return(Y=Object(v.a)(j.a.mark((function e(t){var a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F()({method:"put",url:"".concat(W,"https://api.pinterest.com/v3/visual_search/extension/image/"),headers:A(t),data:t});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var q=a(234),H=a.n(q),J=a(435),G=a(454),K=a(455),Q=a(456),V=a(461),Z=a(457),$=H()((function(e){return{root:{maxWidth:345},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"}}}));function ee(e){var t=$(),a=Object(c.useState)(!1),r=Object(p.a)(a,2),o=r[0],i=r[1];return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("img",{src:e.item.image_square_url,alt:"",onClick:function(){i(!o)}}),Object(n.jsx)(V.a,{className:t.backdrop,open:o,onClick:function(){i(!1)},children:Object(n.jsxs)(G.a,{className:t.root,children:[Object(n.jsx)(K.a,{component:"img",image:e.item.image_large_url}),Object(n.jsxs)(Q.a,{children:[Object(n.jsx)(J.a,{children:e.item.description}),Object(n.jsx)(J.a,{children:e.item.domain}),Object(n.jsx)(Z.a,{href:e.item.link,children:e.item.link})]})]})})]})}var te=H()((function(e){return{root:{display:"flex",flexWrap:"wrap",overflow:"hidden",backgroundColor:e.palette.background.paper,width:450}}}));function ae(e){var t=te();return Object(n.jsx)("div",{className:t.root,children:e.data.map((function(e){return Object(n.jsx)(ee,{item:e},e.id)}))})}var ne=Object(b.a)({resultPanal:{}});function ce(e){var t=Object(c.useState)(null),a=Object(p.a)(t,2),r=a[0],o=a[1],i=Object(c.useState)(!1),s=Object(p.a)(i,2),u=s[0],l=s[1],b=Object(c.useState)(!1),f=Object(p.a)(b,2),j=f[0],v=f[1],h=ne(),m=C();Object(p.a)(m,2)[1];return Object(n.jsxs)(d.a,{item:!0,xs:12,children:[Object(n.jsx)(B.a,{variant:"outlined",onClick:function(){var e=document.getElementById("result_canvas");e&&!u&&(l(!0),e.toBlob((function(e){var t=new FormData;t.append("image",e,"Search Input Image"),t.append("x","0"),t.append("y","0"),t.append("w","1.0"),t.append("h","1.0"),function(e){return Y.apply(this,arguments)}(t).then((function(e){o(e.data),v(!0)})).catch((function(e){console.error(e)})).finally((function(){l(!1)}))})))},disabled:u,children:"Search"}),Object(n.jsx)(X.a,{anchor:"left",open:j,onClose:function(){return v(!1)},className:h.resultPanal,children:Object(n.jsx)(ae,{data:(null===r||void 0===r?void 0:r.data)||[]})})]})}var re=Object(b.a)({root:{margin:20,padding:20,width:"80%",textAlign:"center",marginLeft:"auto",marginRight:"auto"},canvasOuterContainer:{display:"flex",flexDirection:"column",alignItems:"center",padding:20},canvasInnerContainer:{display:"flex",flexDirection:"row"}});function oe(e){var t=re();return Object(n.jsxs)(l.a,{className:t.root,children:[Object(n.jsxs)(d.a,{container:!0,children:[Object(n.jsx)(d.a,{item:!0,xs:12,children:Object(n.jsx)(y,{})}),Object(n.jsxs)(d.a,{item:!0,xs:12,className:t.canvasOuterContainer,children:[Object(n.jsxs)(d.a,{item:!0,xs:12,className:t.canvasInnerContainer,children:[Object(n.jsx)(D,{id:"image_canvas",alt:"image canvas"}),Object(n.jsx)(z,{id:"result_canvas",alt:"result canvas"})]}),Object(n.jsx)(U,{id:"superPixCanvas",alt:"super pixel canvas"})]})]}),Object(n.jsx)(ce,{})]})}var ie=!1,se=Object(b.a)({debug:{position:"fixed",backgroundColor:"rgb(0,0,255,0.25)",top:0,right:0,maxHeight:"100%",overflowY:"scroll","&::-webkit-scrollbar":{width:10},"&::-webkit-scrollbar-thumb":{background:"rgba(0,0,255,0.5)"}},debugMsgItemContainer:{borderWidth:"0px 0px 2px 0px",borderStyle:"dashed",borderColor:"rgb(0,0,255,0.5)",padding:5,display:"flex",flexDirection:"row","&:last-child":{borderStyle:"none"}},debugMsgIdx:{width:25,textAlign:"right",paddingRight:5},debugMsgItem:{width:180}});function ue(e){var t=se(),a=C(),c=Object(p.a)(a,1)[0];return Object(n.jsx)(n.Fragment,{children:ie?Object(n.jsx)("div",{className:t.debug,children:c.map((function(e,a){return Object(n.jsxs)("div",{className:t.debugMsgItemContainer,children:[Object(n.jsx)("span",{className:t.debugMsgIdx,children:"".concat(a+1,". ")},"idx_".concat(a)),Object(n.jsx)("span",{className:t.debugMsgItem,children:e},"item_".concat(a))]},"container_".concat(a))}))}):null})}var le=function(){return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(k,{children:[Object(n.jsx)(g,{children:Object(n.jsx)(oe,{})}),Object(n.jsx)(ue,{})]}),Object(n.jsx)(u.a,{left:"auto",top:"auto",right:0,bottom:0})]})},de=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,463)).then((function(t){var a=t.getCLS,n=t.getFID,c=t.getFCP,r=t.getLCP,o=t.getTTFB;a(e),n(e),c(e),r(e),o(e)}))};i.a.render(Object(n.jsx)(r.a.StrictMode,{children:Object(n.jsx)(le,{})}),document.getElementById("root")),de()}},[[430,1,2]]]);
//# sourceMappingURL=main.e5999130.chunk.js.map